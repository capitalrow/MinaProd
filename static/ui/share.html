<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mina — Shared Conversation</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="max-w-3xl mx-auto p-4 space-y-4">
    <header class="flex items-center gap-3">
      <div class="w-8 h-8 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500"></div>
      <h1 class="text-xl font-semibold">Shared Conversation</h1>
    </header>
    <main id="content" class="rounded-2xl border border-white/10 bg-slate-900/60 p-4">Loading…</main>
  </div>
  <script>
    async function load(){
      const token = location.pathname.split("/").pop();
      try{
        const r = await fetch(`/api/shares/${token}`, {credentials:"include"});
        const data = await r.json();
        if(!r.ok || data.ok===false) throw new Error("Not found");
        const text = (data.segments||[]).map(s=>s.text).join("");
        document.getElementById('content').innerHTML =
          `<div class="text-sm text-slate-400 mb-2">${new Date(data.conversation.created_at).toLocaleString()}</div>
           <div class="text-xl font-semibold mb-3">${data.conversation.title || "Conversation"}</div>
           <div class="whitespace-pre-wrap">${text}</div>
           <div class="mt-4"><button id="exp" class="px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700">Export .txt</button></div>`;
        document.getElementById('exp').onclick=()=>{
          const blob = new Blob([text], {type:"text/plain"});
          const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="mina-shared.txt"; a.click();
        };
      }catch(e){
        document.getElementById('content').innerHTML = `<div class="text-rose-300">Shared link invalid or expired.</div>`;
      }
    }
    load();
  </script>
</body></html>