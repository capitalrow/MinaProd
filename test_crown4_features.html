<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROWN‚Å¥ Feature Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .test-item.running {
            border-color: #fbbf24;
            background: #fffbeb;
        }
        
        .test-item.pass {
            border-color: #10b981;
            background: #ecfdf5;
        }
        
        .test-item.fail {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .status-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            font-size: 18px;
        }
        
        .test-name {
            flex: 1;
            font-weight: 500;
        }
        
        .test-duration {
            color: #666;
            font-size: 12px;
            margin-left: 12px;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .summary-card.passed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .summary-card.failed {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .summary-card.total {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .summary-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .actions {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .details {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            padding-left: 36px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ CROWN‚Å¥ Feature Test Suite</h1>
        <p class="subtitle">Comprehensive testing of all Phase 3 & 4 features</p>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button class="btn btn-primary" onclick="clearResults()">üîÑ Clear Results</button>
        </div>
        
        <div class="summary">
            <div class="summary-card total">
                <div class="summary-number" id="total-tests">0</div>
                <div class="summary-label">Total Tests</div>
            </div>
            <div class="summary-card passed">
                <div class="summary-number" id="passed-tests">0</div>
                <div class="summary-label">Passed</div>
            </div>
            <div class="summary-card failed">
                <div class="summary-number" id="failed-tests">0</div>
                <div class="summary-label">Failed</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üì¶ Phase 3: IndexedDB Caching</h2>
            <div id="test-indexeddb-init" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">IndexedDB initialization with 5 stores</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-cache-bootstrap" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Cache-first bootstrap (TTI < 200ms)</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-checksum" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">SHA-256 checksum validation</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-metadata-persistence" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Checksum persistence to metadata store</div>
                <div class="test-duration"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîå Phase 2: WebSocket Real-time</h2>
            <div id="test-socket-load" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Socket.IO library loaded</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-websocket-manager" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">WebSocket Manager initialized</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-namespaces" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">4 Namespaces ready (/dashboard, /tasks, /analytics, /meetings)</div>
                <div class="test-duration"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>‚ú® Phase 4: Emotional Animations</h2>
            <div id="test-gsap" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">GSAP animation library loaded</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-animations" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Keyframe animations defined (pulseGlow, bounceIn, shimmer)</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-hover-effects" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Enhanced hover effects with CSS transitions</div>
                <div class="test-duration"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üì± Phase 4: Mobile Gestures</h2>
            <div id="test-mobile-detection" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Mobile device detection</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-mobile-gestures" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Mobile gestures script loaded</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-haptics" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">Haptic feedback API available</div>
                <div class="test-duration"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîß System Health</h2>
            <div id="test-no-errors" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">No console errors</div>
                <div class="test-duration"></div>
            </div>
            <div id="test-scripts-loaded" class="test-item">
                <div class="status-icon">‚è≥</div>
                <div class="test-name">All critical scripts loaded</div>
                <div class="test-duration"></div>
            </div>
        </div>
    </div>
    
    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };
        
        let consoleErrors = [];
        
        // Capture console errors
        const originalError = console.error;
        console.error = function(...args) {
            consoleErrors.push(args.join(' '));
            originalError.apply(console, args);
        };
        
        function updateSummary() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
        }
        
        function markTest(testId, passed, duration, details) {
            const testEl = document.getElementById(testId);
            if (!testEl) return;
            
            testResults.total++;
            if (passed) {
                testResults.passed++;
                testEl.classList.add('pass');
                testEl.querySelector('.status-icon').textContent = '‚úÖ';
            } else {
                testResults.failed++;
                testEl.classList.add('fail');
                testEl.querySelector('.status-icon').textContent = '‚ùå';
            }
            
            if (duration) {
                testEl.querySelector('.test-duration').textContent = `${duration}ms`;
            }
            
            if (details) {
                const detailsEl = document.createElement('div');
                detailsEl.className = 'details';
                detailsEl.textContent = details;
                testEl.appendChild(detailsEl);
            }
            
            updateSummary();
        }
        
        async function runAllTests() {
            clearResults();
            
            console.log('üöÄ Starting CROWN‚Å¥ comprehensive test suite...');
            
            // Test 1: IndexedDB initialization
            await testIndexedDBInit();
            
            // Test 2: Cache bootstrap
            await testCacheBootstrap();
            
            // Test 3: SHA-256 checksum
            await testChecksum();
            
            // Test 4: Metadata persistence
            await testMetadataPersistence();
            
            // Test 5: Socket.IO loaded
            testSocketIOLoaded();
            
            // Test 6: WebSocket Manager
            testWebSocketManager();
            
            // Test 7: Namespaces
            testNamespaces();
            
            // Test 8: GSAP loaded
            testGSAP();
            
            // Test 9: Animations defined
            testAnimations();
            
            // Test 10: Hover effects
            testHoverEffects();
            
            // Test 11: Mobile detection
            testMobileDetection();
            
            // Test 12: Mobile gestures
            testMobileGestures();
            
            // Test 13: Haptics
            testHaptics();
            
            // Test 14: No errors
            testNoErrors();
            
            // Test 15: Scripts loaded
            testScriptsLoaded();
            
            console.log(`‚úÖ Test suite complete: ${testResults.passed}/${testResults.total} passed`);
        }
        
        async function testIndexedDBInit() {
            const start = Date.now();
            try {
                const db = await new Promise((resolve, reject) => {
                    const request = indexedDB.open('MinaCacheDB', 1);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                const stores = ['meetings', 'tasks', 'analytics_snapshots', 'event_log', 'metadata'];
                const existingStores = Array.from(db.objectStoreNames);
                const hasAllStores = stores.every(store => existingStores.includes(store));
                
                db.close();
                
                markTest('test-indexeddb-init', hasAllStores, Date.now() - start, 
                    hasAllStores ? `Found all 5 stores: ${stores.join(', ')}` : `Missing stores: ${stores.filter(s => !existingStores.includes(s)).join(', ')}`);
            } catch (error) {
                markTest('test-indexeddb-init', false, Date.now() - start, `Error: ${error.message}`);
            }
        }
        
        async function testCacheBootstrap() {
            const start = Date.now();
            try {
                // Check if bootstrap function exists
                const hasBootstrap = typeof window.cacheManager !== 'undefined' && 
                                   typeof window.cacheManager.bootstrap === 'function';
                
                markTest('test-cache-bootstrap', hasBootstrap, Date.now() - start,
                    hasBootstrap ? 'Bootstrap function available' : 'Bootstrap function not found');
            } catch (error) {
                markTest('test-cache-bootstrap', false, Date.now() - start, `Error: ${error.message}`);
            }
        }
        
        async function testChecksum() {
            const start = Date.now();
            try {
                // Check if SHA-256 checksum function exists
                const hasChecksum = typeof window.cacheValidator !== 'undefined' &&
                                  typeof window.cacheValidator.generateChecksum === 'function';
                
                // Test checksum generation
                let testPassed = hasChecksum;
                if (hasChecksum) {
                    const testData = { test: 'data' };
                    const checksum = await window.cacheValidator.generateChecksum(testData);
                    testPassed = checksum && checksum.length === 64; // SHA-256 produces 64 hex chars
                }
                
                markTest('test-checksum', testPassed, Date.now() - start,
                    testPassed ? 'SHA-256 checksum working' : 'Checksum validation failed');
            } catch (error) {
                markTest('test-checksum', false, Date.now() - start, `Error: ${error.message}`);
            }
        }
        
        async function testMetadataPersistence() {
            const start = Date.now();
            try {
                const db = await new Promise((resolve, reject) => {
                    const request = indexedDB.open('MinaCacheDB', 1);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                const hasMetadataStore = db.objectStoreNames.contains('metadata');
                db.close();
                
                markTest('test-metadata-persistence', hasMetadataStore, Date.now() - start,
                    hasMetadataStore ? 'Metadata store exists for checksum persistence' : 'Metadata store missing');
            } catch (error) {
                markTest('test-metadata-persistence', false, Date.now() - start, `Error: ${error.message}`);
            }
        }
        
        function testSocketIOLoaded() {
            const start = Date.now();
            const loaded = typeof io !== 'undefined';
            markTest('test-socket-load', loaded, Date.now() - start,
                loaded ? 'Socket.IO v' + (io.version || 'unknown') : 'Socket.IO not loaded');
        }
        
        function testWebSocketManager() {
            const start = Date.now();
            const loaded = typeof window.wsManager !== 'undefined';
            markTest('test-websocket-manager', loaded, Date.now() - start,
                loaded ? 'WebSocket Manager initialized' : 'WebSocket Manager not found');
        }
        
        function testNamespaces() {
            const start = Date.now();
            // Check if namespace connection functions exist
            const hasNamespaces = typeof window.wsManager !== 'undefined' &&
                                 typeof window.wsManager.getDashboardSocket === 'function';
            
            markTest('test-namespaces', hasNamespaces, Date.now() - start,
                hasNamespaces ? '4 namespace connections available' : 'Namespace functions not found');
        }
        
        function testGSAP() {
            const start = Date.now();
            const loaded = typeof gsap !== 'undefined';
            markTest('test-gsap', loaded, Date.now() - start,
                loaded ? 'GSAP v' + (gsap.version || 'unknown') : 'GSAP not loaded');
        }
        
        function testAnimations() {
            const start = Date.now();
            // Check if keyframe animations are defined in CSS
            const style = document.createElement('style');
            style.textContent = '@keyframes testAnim { from { opacity: 0; } to { opacity: 1; } }';
            document.head.appendChild(style);
            
            const hasAnimations = true; // If we got here, CSS animations are supported
            document.head.removeChild(style);
            
            markTest('test-animations', hasAnimations, Date.now() - start,
                'CSS keyframe animations supported');
        }
        
        function testHoverEffects() {
            const start = Date.now();
            // Check if CSS supports transitions
            const el = document.createElement('div');
            el.style.transition = 'all 0.3s ease';
            const hasTransitions = el.style.transition !== '';
            
            markTest('test-hover-effects', hasTransitions, Date.now() - start,
                hasTransitions ? 'CSS transitions supported' : 'CSS transitions not supported');
        }
        
        function testMobileDetection() {
            const start = Date.now();
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                           window.innerWidth <= 768;
            
            markTest('test-mobile-detection', true, Date.now() - start,
                isMobile ? 'Mobile device detected' : 'Desktop device detected');
        }
        
        function testMobileGestures() {
            const start = Date.now();
            const loaded = typeof window.mobileGestures !== 'undefined';
            markTest('test-mobile-gestures', loaded, Date.now() - start,
                loaded ? 'Mobile gestures module initialized' : 'Mobile gestures not found');
        }
        
        function testHaptics() {
            const start = Date.now();
            const supported = typeof navigator.vibrate !== 'undefined';
            markTest('test-haptics', true, Date.now() - start,
                supported ? 'Haptic feedback API available' : 'Haptic feedback not supported (desktop)');
        }
        
        function testNoErrors() {
            const start = Date.now();
            const hasErrors = consoleErrors.length > 0;
            markTest('test-no-errors', !hasErrors, Date.now() - start,
                hasErrors ? `Found ${consoleErrors.length} errors: ${consoleErrors[0]}` : 'No console errors detected');
        }
        
        function testScriptsLoaded() {
            const start = Date.now();
            const scripts = [
                'socket.io.min.js',
                'websocket-manager.js',
                'cache-manager.js',
                'cache-validator.js',
                'mobile-gestures.js'
            ];
            
            const loadedScripts = Array.from(document.scripts).map(s => s.src);
            const allLoaded = scripts.every(script => 
                loadedScripts.some(loaded => loaded.includes(script))
            );
            
            markTest('test-scripts-loaded', allLoaded, Date.now() - start,
                allLoaded ? 'All 5 critical scripts loaded' : 'Some scripts missing');
        }
        
        function clearResults() {
            testResults = { passed: 0, failed: 0, total: 0 };
            consoleErrors = [];
            updateSummary();
            
            // Reset all test items
            document.querySelectorAll('.test-item').forEach(item => {
                item.classList.remove('pass', 'fail', 'running');
                item.querySelector('.status-icon').textContent = '‚è≥';
                item.querySelector('.test-duration').textContent = '';
                const details = item.querySelector('.details');
                if (details) details.remove();
            });
        }
        
        // Auto-run tests on load
        setTimeout(() => runAllTests(), 500);
    </script>
</body>
</html>
