<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="{% block description %}Mina - Professional AI-powered speech transcription platform with Google Recorder-level performance{% endblock %}">
    <meta name="keywords" content="{% block keywords %}speech transcription, AI, real-time, voice to text, meeting transcription{% endblock %}">
    <meta name="author" content="Mina Transcription Platform">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.description() }}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ self.title() }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ self.description() }}{% endblock %}">
    
    <title>{% block title %}Mina - Professional Speech Transcription{% endblock %}</title>
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- Modern Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Modern Design System -->
    <link href="/static/css/modern_design_system.css" rel="stylesheet">
    <link href="/static/css/enhanced_component_library.css" rel="stylesheet">
    
    <!-- Custom Page Styles -->
    {% block extra_css %}{% endblock %}
    
    <!-- Theme Color for PWA -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    
    <!-- Critical CSS for above-the-fold content -->
    <style>
        /* Critical styles for immediate rendering */
        .mina-loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--mina-primary-50) 0%, var(--mina-secondary-50) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .mina-loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .mina-loading-content {
            text-align: center;
            color: var(--mina-primary-600);
        }
        
        .mina-loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--mina-primary-200);
            border-top: 4px solid var(--mina-primary-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Prevent flash of unstyled content */
        body {
            visibility: hidden;
        }
        
        body.loaded {
            visibility: visible;
        }
        
        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--mina-neutral-900);
            color: var(--mina-neutral-0);
            padding: 8px 16px;
            text-decoration: none;
            border-radius: var(--mina-radius-md);
            z-index: 10000;
            transition: top 0.3s ease;
        }
        
        .skip-link:focus {
            top: 6px;
        }
    </style>
</head>
<body class="d-flex flex-column h-100">
    <!-- Loading Screen -->
    <div class="mina-loading-screen" id="loadingScreen">
        <div class="mina-loading-content">
            <div class="mina-loading-spinner"></div>
            <div class="mina-font-medium">Loading Mina...</div>
        </div>
    </div>
    
    <!-- Skip to main content link for accessibility -->
    <a class="skip-link" href="#main-content">Skip to main content</a>
    
    <!-- Enhanced Navigation -->
    <nav class="mina-navbar" role="navigation" aria-label="Main navigation">
        <div class="mina-navbar-container">
            <a href="{{ url_for('transcription.list_sessions') }}" class="mina-navbar-brand" aria-label="Mina homepage">
                <div class="mina-navbar-brand-icon">
                    <i class="bi bi-mic-fill" aria-hidden="true"></i>
                </div>
                <span>Mina</span>
            </a>
            
            <ul class="mina-navbar-nav">
                <li class="mina-navbar-nav-item">
                    <a href="{{ url_for('transcription.list_sessions') }}" class="mina-navbar-nav-link">
                        <i class="bi bi-house" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="mina-navbar-nav-item">
                    <a href="{{ url_for('transcription.live_transcription') }}" class="mina-navbar-nav-link">
                        <i class="bi bi-mic" aria-hidden="true"></i>
                        <span>Live Transcription</span>
                    </a>
                </li>
                <li class="mina-navbar-nav-item">
                    <a href="{{ url_for('transcription.list_sessions') }}" class="mina-navbar-nav-link">
                        <i class="bi bi-folder" aria-hidden="true"></i>
                        <span>Sessions</span>
                    </a>
                </li>
                <li class="mina-navbar-nav-item">
                    <a href="/api/enhanced-ws/health" class="mina-navbar-nav-link" target="_blank" rel="noopener">
                        <i class="bi bi-activity" aria-hidden="true"></i>
                        <span>System Health</span>
                    </a>
                </li>
            </ul>
            
            <!-- Mobile menu toggle -->
            <button class="mina-navbar-toggle" type="button" aria-label="Toggle navigation menu" aria-expanded="false">
                <div class="mina-navbar-toggle-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="flex-shrink-0" id="main-content" role="main">
        <!-- Breadcrumb Navigation -->
        {% block breadcrumb %}
        {% if breadcrumb_items %}
        <nav aria-label="Breadcrumb" class="py-3">
            <div class="container">
                <ol class="breadcrumb mb-0">
                    {% for item in breadcrumb_items %}
                    <li class="breadcrumb-item{% if loop.last %} active{% endif %}"{% if loop.last %} aria-current="page"{% endif %}>
                        {% if not loop.last %}
                        <a href="{{ item.url }}" class="text-decoration-none">{{ item.text }}</a>
                        {% else %}
                        {{ item.text }}
                        {% endif %}
                    </li>
                    {% endfor %}
                </ol>
            </div>
        </nav>
        {% endif %}
        {% endblock %}
        
        <!-- Page Content -->
        {% block content %}{% endblock %}
    </main>
    
    <!-- Enhanced Footer -->
    <footer class="mt-auto py-5" style="background: var(--mina-neutral-900); color: var(--mina-neutral-300);">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4 col-md-6">
                    <div class="d-flex align-items-center mb-3">
                        <div class="mina-navbar-brand-icon me-2">
                            <i class="bi bi-mic-fill"></i>
                        </div>
                        <h5 class="mb-0 text-white">Mina</h5>
                    </div>
                    <p class="mb-3">Professional AI-powered speech transcription platform with Google Recorder-level performance and real-time processing.</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);" aria-label="Follow us on Twitter">
                            <i class="bi bi-twitter fs-5"></i>
                        </a>
                        <a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);" aria-label="Follow us on LinkedIn">
                            <i class="bi bi-linkedin fs-5"></i>
                        </a>
                        <a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);" aria-label="View our GitHub">
                            <i class="bi bi-github fs-5"></i>
                        </a>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-6">
                    <h6 class="text-white mb-3">Product</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{{ url_for('transcription.live_transcription') }}" class="text-decoration-none" style="color: var(--mina-neutral-400);">Live Transcription</a></li>
                        <li class="mb-2"><a href="{{ url_for('sessions.list_sessions') }}" class="text-decoration-none" style="color: var(--mina-neutral-400);">Session Management</a></li>
                        <li class="mb-2"><a href="/api/enhanced-ws/info" class="text-decoration-none" style="color: var(--mina-neutral-400);">API Documentation</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-2 col-md-6">
                    <h6 class="text-white mb-3">Support</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="/api/enhanced-ws/health" class="text-decoration-none" style="color: var(--mina-neutral-400);">System Status</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);">Help Center</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);">Contact Support</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-4 col-md-6">
                    <h6 class="text-white mb-3">System Information</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="p-2 rounded" style="background: var(--mina-neutral-800);">
                                <div class="small text-muted">Status</div>
                                <div class="fw-medium text-success">
                                    <i class="bi bi-circle-fill me-1" style="font-size: 0.5rem;"></i>
                                    Online
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-2 rounded" style="background: var(--mina-neutral-800);">
                                <div class="small text-muted">Performance</div>
                                <div class="fw-medium text-info">
                                    <i class="bi bi-lightning-fill me-1"></i>
                                    Optimal
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <hr class="my-4" style="border-color: var(--mina-neutral-700);">
            
            <div class="row align-items-center">
                <div class="col-md-6">
                    <small style="color: var(--mina-neutral-400);">
                        Â© 2024 Mina Transcription Platform. All rights reserved.
                    </small>
                </div>
                <div class="col-md-6 text-md-end">
                    <small style="color: var(--mina-neutral-400);">
                        <a href="#" class="text-decoration-none me-3" style="color: var(--mina-neutral-400);">Privacy Policy</a>
                        <a href="#" class="text-decoration-none me-3" style="color: var(--mina-neutral-400);">Terms of Service</a>
                        <a href="#" class="text-decoration-none" style="color: var(--mina-neutral-400);">Accessibility</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Toast Container -->
    <div class="mina-toast-container"></div>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Modern UI Interactions -->
    <script src="/static/js/modern_ui_interactions.js"></script>
    
    <!-- Page-specific JavaScript -->
    {% block extra_js %}{% endblock %}
    
    <!-- Initialize app -->
    <script>
        // Remove loading screen after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('loaded');
            
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.classList.add('hidden');
                    setTimeout(() => {
                        loadingScreen.remove();
                    }, 500);
                }
            }, 500);
        });
        
        // Update active navigation
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.mina-navbar-nav-link');
            
            navLinks.forEach(link => {
                const linkPath = new URL(link.href).pathname;
                if (linkPath === currentPath || (currentPath !== '/' && linkPath !== '/' && currentPath.startsWith(linkPath))) {
                    link.classList.add('active');
                }
            });
        });
        
        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e);
            if (window.showToast) {
                window.showToast('An unexpected error occurred. Please refresh the page if issues persist.', 'error', 'Error');
            }
        });
        
        // Service worker registration (for PWA features)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js').then(function(registration) {
                    console.log('SW registered: ', registration);
                }).catch(function(registrationError) {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }
    </script>
    
    {% block footer_js %}{% endblock %}
</body>
</html>