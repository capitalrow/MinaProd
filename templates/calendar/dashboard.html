{% extends "base.html" %}

{% block title %}Calendar Integration - {{ super() }}{% endblock %}

{% block extra_head %}
<style>
    .calendar-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .provider-card {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }
    
    .provider-card:hover {
        border-color: var(--accent-primary);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .provider-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .provider-info {
        display: flex;
        align-items: center;
    }
    
    .provider-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.5rem;
        color: white;
    }
    
    .google-icon {
        background: linear-gradient(45deg, #4285f4, #34a853);
    }
    
    .outlook-icon {
        background: linear-gradient(45deg, #0078d4, #106ebe);
    }
    
    .provider-details h4 {
        margin: 0 0 0.25rem 0;
        color: var(--text-primary);
    }
    
    .provider-details p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .status-connected {
        background: rgba(34, 197, 94, 0.1);
        color: #22c55e;
    }
    
    .status-disconnected {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 2rem;
        margin-top: 2rem;
    }
    
    .calendar-sidebar {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        height: fit-content;
    }
    
    .calendar-main {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        min-height: 600px;
    }
    
    .event-card {
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--accent-primary);
        transition: all 0.2s ease;
    }
    
    .event-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .event-header {
        display: flex;
        justify-content: between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }
    
    .event-title {
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
    }
    
    .event-time {
        font-size: 0.875rem;
        color: var(--text-secondary);
        white-space: nowrap;
    }
    
    .event-details {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }
    
    .event-provider {
        display: inline-flex;
        align-items: center;
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        background: var(--bg-primary);
        color: var(--text-secondary);
    }
    
    .event-provider.google {
        background: rgba(66, 133, 244, 0.1);
        color: #4285f4;
    }
    
    .event-provider.outlook {
        background: rgba(0, 120, 212, 0.1);
        color: #0078d4;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .action-button {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        transition: all 0.2s ease;
        cursor: pointer;
        text-decoration: none;
        color: var(--text-primary);
    }
    
    .action-button:hover {
        border-color: var(--accent-primary);
        background: var(--bg-hover);
        color: var(--text-primary);
        text-decoration: none;
    }
    
    .action-button i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-secondary);
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid var(--border-color);
        border-radius: 50%;
        border-top-color: var(--accent-primary);
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
    
    .date-picker {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .date-picker input {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 0.5rem;
        border-radius: 6px;
    }
    
    @media (max-width: 768px) {
        .calendar-container {
            padding: 1rem;
        }
        
        .calendar-grid {
            grid-template-columns: 1fr;
        }
        
        .provider-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .quick-actions {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="calendar-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">
            <i class="fas fa-calendar-alt me-2"></i>
            Calendar Integration
        </h1>
        <div>
            <button class="btn btn-outline-primary me-2" onclick="syncCalendars()">
                <i class="fas fa-sync me-1"></i>
                Sync
            </button>
            <button class="btn btn-primary" onclick="createEventModal()">
                <i class="fas fa-plus me-1"></i>
                Create Event
            </button>
        </div>
    </div>
    
    <!-- Provider Status Cards -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="provider-card">
                <div class="provider-header">
                    <div class="provider-info">
                        <div class="provider-icon google-icon">
                            <i class="fab fa-google"></i>
                        </div>
                        <div class="provider-details">
                            <h4>Google Calendar</h4>
                            <p>Sync with your Google Calendar events</p>
                        </div>
                    </div>
                    <div id="google-status" class="status-badge status-disconnected">
                        <span class="loading-spinner"></span> Checking...
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button id="google-connect" class="btn btn-outline-primary btn-sm" style="display: none;">
                        <i class="fab fa-google me-1"></i>
                        Connect
                    </button>
                    <button id="google-disconnect" class="btn btn-outline-danger btn-sm" style="display: none;">
                        <i class="fas fa-unlink me-1"></i>
                        Disconnect
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="provider-card">
                <div class="provider-header">
                    <div class="provider-info">
                        <div class="provider-icon outlook-icon">
                            <i class="fab fa-microsoft"></i>
                        </div>
                        <div class="provider-details">
                            <h4>Outlook Calendar</h4>
                            <p>Sync with your Outlook/Office 365 calendar</p>
                        </div>
                    </div>
                    <div id="outlook-status" class="status-badge status-disconnected">
                        <span class="loading-spinner"></span> Checking...
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button id="outlook-connect" class="btn btn-outline-primary btn-sm" style="display: none;">
                        <i class="fab fa-microsoft me-1"></i>
                        Connect
                    </button>
                    <button id="outlook-disconnect" class="btn btn-outline-danger btn-sm" style="display: none;">
                        <i class="fas fa-unlink me-1"></i>
                        Disconnect
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <a href="#" class="action-button" onclick="createEventFromSummary()">
            <i class="fas fa-file-text"></i>
            <strong>Create from Summary</strong>
            <small class="d-block">Turn meeting summaries into calendar events</small>
        </a>
        <a href="#" class="action-button" onclick="bulkImport()">
            <i class="fas fa-download"></i>
            <strong>Bulk Import</strong>
            <small class="d-block">Import multiple events at once</small>
        </a>
    </div>
    
    <!-- Calendar Grid -->
    <div class="calendar-grid">
        <!-- Sidebar -->
        <div class="calendar-sidebar">
            <h4><i class="fas fa-filter me-2"></i>Filters</h4>
            
            <div class="date-picker">
                <label for="start-date">From:</label>
                <input type="date" id="start-date" class="form-control form-control-sm">
            </div>
            
            <div class="date-picker">
                <label for="end-date">To:</label>
                <input type="date" id="end-date" class="form-control form-control-sm">
            </div>
            
            <h5 class="mt-3 mb-2">Providers</h5>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filter-google" checked>
                <label class="form-check-label" for="filter-google">
                    <i class="fab fa-google me-1"></i> Google Calendar
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filter-outlook" checked>
                <label class="form-check-label" for="filter-outlook">
                    <i class="fab fa-microsoft me-1"></i> Outlook Calendar
                </label>
            </div>
            
            <h5 class="mt-3 mb-2">Event Types</h5>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filter-mina" checked>
                <label class="form-check-label" for="filter-mina">
                    <i class="fas fa-microphone me-1"></i> Mina Meetings
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filter-regular" checked>
                <label class="form-check-label" for="filter-regular">
                    <i class="fas fa-calendar me-1"></i> Regular Events
                </label>
            </div>
            
            <button class="btn btn-outline-primary btn-sm mt-3 w-100" onclick="applyFilters()">
                <i class="fas fa-filter me-1"></i>
                Apply Filters
            </button>
        </div>
        
        <!-- Main Calendar View -->
        <div class="calendar-main">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4><i class="fas fa-calendar-week me-2"></i>Upcoming Events</h4>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-secondary active" onclick="setView('week')">Week</button>
                    <button type="button" class="btn btn-outline-secondary" onclick="setView('month')">Month</button>
                </div>
            </div>
            
            <!-- Events List -->
            <div id="events-container">
                <div class="empty-state">
                    <i class="fas fa-calendar-plus"></i>
                    <h5>Loading calendar events...</h5>
                    <p>Please wait while we fetch your calendar data.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Event Modal -->
<div class="modal fade" id="createEventModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus-circle me-2"></i>
                    Create Calendar Event
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createEventForm">
                    <div class="mb-3">
                        <label for="event-provider" class="form-label">Calendar Provider</label>
                        <select class="form-select" id="event-provider" required>
                            <option value="">Select a calendar provider</option>
                            <option value="google">Google Calendar</option>
                            <option value="outlook">Outlook Calendar</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="event-title" class="form-label">Event Title</label>
                        <input type="text" class="form-control" id="event-title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="event-description" class="form-label">Description</label>
                        <textarea class="form-control" id="event-description" rows="3"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="event-start-date" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="event-start-date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="event-start-time" class="form-label">Start Time</label>
                            <input type="time" class="form-control" id="event-start-time" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="event-end-date" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="event-end-date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="event-end-time" class="form-label">End Time</label>
                            <input type="time" class="form-control" id="event-end-time" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="event-location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="event-location" placeholder="Meeting room, online link, etc.">
                    </div>
                    
                    <div class="mb-3">
                        <label for="event-attendees" class="form-label">Attendees</label>
                        <input type="email" class="form-control" id="event-attendees" placeholder="email@example.com (press Enter to add)">
                        <div id="attendees-list" class="mt-2"></div>
                    </div>
                    
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="event-mina-meeting">
                        <label class="form-check-label" for="event-mina-meeting">
                            This is a Mina recording meeting
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveEvent()">
                    <i class="fas fa-save me-1"></i>
                    Create Event
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast for notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="calendarToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="fas fa-calendar me-2"></i>
            <strong class="me-auto">Calendar</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            <!-- Message will be inserted here -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
class CalendarManager {
    constructor() {
        this.events = [];
        this.attendeesList = [];
        this.init();
    }
    
    init() {
        this.loadProviderStatus();
        this.loadEvents();
        this.setupEventListeners();
        this.setDefaultDates();
    }
    
    async loadProviderStatus() {
        try {
            const response = await fetch('/calendar/api/providers/status');
            const result = await response.json();
            
            if (result.success) {
                this.updateProviderUI('google', result.status.google);
                this.updateProviderUI('outlook', result.status.outlook);
            }
        } catch (error) {
            console.error('Error loading provider status:', error);
            this.showToast('Failed to load calendar provider status', 'error');
        }
    }
    
    updateProviderUI(provider, isConnected) {
        const statusElement = document.getElementById(`${provider}-status`);
        const connectBtn = document.getElementById(`${provider}-connect`);
        const disconnectBtn = document.getElementById(`${provider}-disconnect`);
        
        if (isConnected) {
            statusElement.textContent = 'Connected';
            statusElement.className = 'status-badge status-connected';
            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'inline-block';
        } else {
            statusElement.textContent = 'Disconnected';
            statusElement.className = 'status-badge status-disconnected';
            connectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'none';
        }
    }
    
    async loadEvents() {
        try {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            const params = new URLSearchParams();
            if (startDate) params.append('start_date', startDate);
            if (endDate) params.append('end_date', endDate);
            
            const response = await fetch(`/calendar/api/events?${params}`);
            const result = await response.json();
            
            if (result.success) {
                this.events = result.events;
                this.renderEvents();
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            console.error('Error loading events:', error);
            this.renderEmptyState('Failed to load calendar events');
        }
    }
    
    renderEvents() {
        const container = document.getElementById('events-container');
        
        if (this.events.length === 0) {
            this.renderEmptyState('No events found for this time period');
            return;
        }
        
        container.innerHTML = this.events.map(event => `
            <div class="event-card">
                <div class="event-header">
                    <h6 class="event-title">${event.title}</h6>
                    <div class="event-time">
                        ${this.formatEventTime(event.start_time, event.end_time)}
                    </div>
                </div>
                <div class="event-details">
                    ${event.description || 'No description'}
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="event-provider ${event.provider}">
                        <i class="${event.provider === 'google' ? 'fab fa-google' : 'fab fa-microsoft'} me-1"></i>
                        ${event.provider === 'google' ? 'Google' : 'Outlook'}
                    </span>
                    ${event.is_mina_meeting ? '<span class="badge bg-primary">Mina Meeting</span>' : ''}
                </div>
            </div>
        `).join('');
    }
    
    renderEmptyState(message) {
        const container = document.getElementById('events-container');
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-calendar-times"></i>
                <h5>${message}</h5>
                <p>Try adjusting your date range or connecting more calendar providers.</p>
            </div>
        `;
    }
    
    formatEventTime(startTime, endTime) {
        const start = new Date(startTime);
        const end = new Date(endTime);
        
        const startStr = start.toLocaleDateString() + ' ' + start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const endStr = end.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        return `${startStr} - ${endStr}`;
    }
    
    setupEventListeners() {
        // Provider connection buttons
        document.getElementById('google-connect').addEventListener('click', () => this.connectProvider('google'));
        document.getElementById('google-disconnect').addEventListener('click', () => this.disconnectProvider('google'));
        document.getElementById('outlook-connect').addEventListener('click', () => this.connectProvider('outlook'));
        document.getElementById('outlook-disconnect').addEventListener('click', () => this.disconnectProvider('outlook'));
        
        // Date filters
        document.getElementById('start-date').addEventListener('change', () => this.loadEvents());
        document.getElementById('end-date').addEventListener('change', () => this.loadEvents());
        
        // Attendees input
        document.getElementById('event-attendees').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.addAttendee();
            }
        });
    }
    
    setDefaultDates() {
        const today = new Date();
        const nextWeek = new Date(today);
        nextWeek.setDate(today.getDate() + 7);
        
        document.getElementById('start-date').value = today.toISOString().split('T')[0];
        document.getElementById('end-date').value = nextWeek.toISOString().split('T')[0];
    }
    
    async connectProvider(provider) {
        try {
            // Mock authentication for demo
            const response = await fetch(`/calendar/api/authenticate/${provider}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ credentials: { demo: true } })
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.updateProviderUI(provider, true);
                this.showToast(`${provider} Calendar connected successfully`, 'success');
                this.loadEvents();
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            console.error(`Error connecting ${provider}:`, error);
            this.showToast(`Failed to connect ${provider} Calendar`, 'error');
        }
    }
    
    async disconnectProvider(provider) {
        try {
            const response = await fetch(`/calendar/api/disconnect/${provider}`, {
                method: 'POST'
            });
            
            const result = await response.json();
            
            if (result.success) {
                this.updateProviderUI(provider, false);
                this.showToast(`${provider} Calendar disconnected`, 'success');
                this.loadEvents();
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            console.error(`Error disconnecting ${provider}:`, error);
            this.showToast(`Failed to disconnect ${provider} Calendar`, 'error');
        }
    }
    
    addAttendee() {
        const input = document.getElementById('event-attendees');
        const email = input.value.trim();
        
        if (email && this.isValidEmail(email) && !this.attendeesList.includes(email)) {
            this.attendeesList.push(email);
            this.renderAttendeesList();
            input.value = '';
        }
    }
    
    removeAttendee(email) {
        this.attendeesList = this.attendeesList.filter(a => a !== email);
        this.renderAttendeesList();
    }
    
    renderAttendeesList() {
        const container = document.getElementById('attendees-list');
        container.innerHTML = this.attendeesList.map(email => `
            <span class="badge bg-secondary me-1 mb-1">
                ${email}
                <button type="button" class="btn-close btn-close-white ms-1" onclick="calendarManager.removeAttendee('${email}')"></button>
            </span>
        `).join('');
    }
    
    isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    
    showToast(message, type = 'info') {
        const toast = document.getElementById('calendarToast');
        const toastBody = toast.querySelector('.toast-body');
        
        toastBody.textContent = message;
        toast.className = `toast ${type === 'error' ? 'text-bg-danger' : 'text-bg-success'}`;
        
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
    }
}

// Global functions
async function syncCalendars() {
    try {
        const response = await fetch('/calendar/api/sync', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            calendarManager.showToast('Calendar sync completed', 'success');
            calendarManager.loadEvents();
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        console.error('Error syncing calendars:', error);
        calendarManager.showToast('Failed to sync calendars', 'error');
    }
}

function createEventModal() {
    const modal = new bootstrap.Modal(document.getElementById('createEventModal'));
    modal.show();
}

async function saveEvent() {
    try {
        const form = document.getElementById('createEventForm');
        const formData = new FormData(form);
        
        const startDate = document.getElementById('event-start-date').value;
        const startTime = document.getElementById('event-start-time').value;
        const endDate = document.getElementById('event-end-date').value;
        const endTime = document.getElementById('event-end-time').value;
        
        const eventData = {
            provider: document.getElementById('event-provider').value,
            title: document.getElementById('event-title').value,
            description: document.getElementById('event-description').value,
            start_time: `${startDate}T${startTime}:00`,
            end_time: `${endDate}T${endTime}:00`,
            location: document.getElementById('event-location').value,
            attendees: calendarManager.attendeesList,
            is_mina_meeting: document.getElementById('event-mina-meeting').checked
        };
        
        const response = await fetch('/calendar/api/events', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(eventData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            calendarManager.showToast('Event created successfully', 'success');
            bootstrap.Modal.getInstance(document.getElementById('createEventModal')).hide();
            calendarManager.loadEvents();
            form.reset();
            calendarManager.attendeesList = [];
            calendarManager.renderAttendeesList();
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        console.error('Error creating event:', error);
        calendarManager.showToast('Failed to create event', 'error');
    }
}

function createEventFromSummary() {
    // This would open a modal to select from existing summaries
    calendarManager.showToast('Summary integration coming soon', 'info');
}

function bulkImport() {
    // This would open a bulk import dialog
    calendarManager.showToast('Bulk import coming soon', 'info');
}

function applyFilters() {
    calendarManager.loadEvents();
}

function setView(view) {
    // Update active view button
    document.querySelectorAll('.btn-group button').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // This would switch between week/month views
    calendarManager.showToast(`Switched to ${view} view`, 'info');
}

// Initialize calendar manager when page loads
let calendarManager;
document.addEventListener('DOMContentLoaded', () => {
    calendarManager = new CalendarManager();
});
</script>
{% endblock %}