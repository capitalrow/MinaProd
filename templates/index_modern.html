{% extends "base.html" %}

{% block title %}Dashboard - Mina Professional Transcription{% endblock %}

{% block description %}Professional dashboard for AI-powered speech transcription with real-time monitoring and session management.{% endblock %}

{% block keywords %}dashboard, transcription analytics, session management, AI transcription{% endblock %}

{% block head %}
<style>
    .mina-hero-dashboard {
        background: linear-gradient(135deg, var(--mina-primary-50) 0%, var(--mina-secondary-50) 100%);
        padding: var(--mina-space-16) 0 var(--mina-space-12);
        position: relative;
        overflow: hidden;
    }
    
    .mina-hero-dashboard::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
        animation: mina-float 20s ease-in-out infinite;
    }
    
    .mina-hero-stats {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border: 1px solid var(--mina-neutral-200);
        border-radius: var(--mina-radius-2xl);
        padding: var(--mina-space-8);
        box-shadow: var(--mina-shadow-xl);
    }
    
    .mina-quick-action {
        background: var(--mina-neutral-0);
        border: 1px solid var(--mina-neutral-200);
        border-radius: var(--mina-radius-xl);
        padding: var(--mina-space-6);
        text-align: center;
        transition: all var(--mina-transition-medium);
        text-decoration: none;
        color: inherit;
        display: block;
        height: 100%;
    }
    
    .mina-quick-action:hover {
        transform: translateY(-4px);
        box-shadow: var(--mina-shadow-xl);
        border-color: var(--mina-primary-300);
        color: inherit;
        text-decoration: none;
    }
    
    .mina-quick-action-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, var(--mina-primary-500) 0%, var(--mina-secondary-500) 100%);
        border-radius: var(--mina-radius-2xl);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--mina-space-4);
        color: white;
        font-size: var(--mina-text-2xl);
    }
    
    .mina-activity-item {
        padding: var(--mina-space-4);
        border-bottom: 1px solid var(--mina-neutral-200);
        transition: background-color var(--mina-transition-fast);
    }
    
    .mina-activity-item:hover {
        background: var(--mina-neutral-50);
    }
    
    .mina-activity-item:last-child {
        border-bottom: none;
    }
    
    .mina-progress-ring {
        width: 120px;
        height: 120px;
        position: relative;
    }
    
    .mina-progress-ring svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
    }
    
    .mina-progress-ring circle {
        fill: none;
        stroke-width: 8;
        stroke-linecap: round;
    }
    
    .mina-progress-ring .bg {
        stroke: var(--mina-neutral-200);
    }
    
    .mina-progress-ring .progress {
        stroke: var(--mina-primary-500);
        stroke-dasharray: 283;
        stroke-dashoffset: 283;
        transition: stroke-dashoffset 1s ease-in-out;
    }
    
    .mina-progress-ring .progress.animate {
        stroke-dashoffset: calc(283 - (283 * var(--progress)) / 100);
    }
    
    .mina-progress-ring .text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<!-- Enhanced Hero Section -->
<section class="mina-hero-dashboard">
    <div class="container position-relative" style="z-index: 1;">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="mina-heading-1 mb-4">
                    Welcome to Your <span style="background: linear-gradient(135deg, var(--mina-primary-600) 0%, var(--mina-secondary-600) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Transcription Dashboard</span>
                </h1>
                <p class="mina-text-xl text-muted mb-6">
                    Monitor your AI-powered transcription sessions, track performance metrics, and manage your voice-to-text workflows with professional-grade tools.
                </p>
                <div class="d-flex flex-column flex-sm-row gap-3">
                    <a href="{{ url_for('transcription.live_transcription') }}" class="mina-btn mina-btn-primary mina-btn-lg">
                        <i class="bi bi-mic-fill"></i>
                        Start New Session
                        <i class="bi bi-arrow-right"></i>
                    </a>
                    <button onclick="window.runSystemValidation()" class="mina-btn mina-btn-outline mina-btn-lg">
                        <i class="bi bi-shield-check"></i>
                        Run System Check
                    </button>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="mina-hero-stats">
                    <div class="text-center mb-4">
                        <h5 class="mina-heading-5">System Performance</h5>
                        <p class="text-muted small mb-0">Real-time metrics</p>
                    </div>
                    <div class="d-flex justify-content-center mb-4">
                        <div class="mina-progress-ring">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45"></circle>
                                <circle class="progress" cx="50" cy="50" r="45" style="--progress: 92"></circle>
                            </svg>
                            <div class="text">
                                <div class="h4 mb-0 fw-bold text-primary">92%</div>
                                <div class="small text-muted">Uptime</div>
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 text-center">
                        <div class="col-4">
                            <div class="small text-muted">Latency</div>
                            <div class="fw-bold text-success">< 400ms</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">Accuracy</div>
                            <div class="fw-bold text-info">95.8%</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">Sessions</div>
                            <div class="fw-bold text-warning">{{ stats.get('total_sessions', 0) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Key Metrics Section -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center mb-5">
            <div class="col">
                <h2 class="mina-heading-2">Performance Metrics</h2>
                <p class="text-muted">Overview of your transcription system performance</p>
            </div>
            <div class="col-auto">
                <button onclick="location.reload()" class="mina-btn mina-btn-ghost">
                    <i class="bi bi-arrow-clockwise"></i>
                    Refresh
                </button>
            </div>
        </div>
        
        <div class="mina-metrics-grid">
            <div class="mina-stat-card">
                <div class="mina-stat-card-icon">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <div class="mina-stat-card-value">{{ stats.get('total_sessions', 0) }}</div>
                <div class="mina-stat-card-label">Total Sessions</div>
                <div class="mina-stat-card-trend positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+12% this month</span>
                </div>
            </div>
            
            <div class="mina-stat-card">
                <div class="mina-stat-card-icon">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="mina-stat-card-value">{{ stats.get('active_sessions', 0) }}</div>
                <div class="mina-stat-card-label">Active Sessions</div>
                <div class="mina-stat-card-trend positive">
                    <i class="bi bi-circle-fill mina-pulse"></i>
                    <span>Real-time</span>
                </div>
            </div>
            
            <div class="mina-stat-card">
                <div class="mina-stat-card-icon">
                    <i class="bi bi-file-text"></i>
                </div>
                <div class="mina-stat-card-value">{{ stats.get('total_segments', 0) }}</div>
                <div class="mina-stat-card-label">Text Segments</div>
                <div class="mina-stat-card-trend positive">
                    <i class="bi bi-arrow-up"></i>
                    <span>+8% accuracy</span>
                </div>
            </div>
            
            <div class="mina-stat-card">
                <div class="mina-stat-card-icon">
                    <i class="bi bi-speedometer2"></i>
                </div>
                <div class="mina-stat-card-value">< 400ms</div>
                <div class="mina-stat-card-label">Avg Latency</div>
                <div class="mina-stat-card-trend positive">
                    <i class="bi bi-lightning-fill"></i>
                    <span>Google Recorder-level</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quick Actions Section -->
<section class="py-5" style="background: var(--mina-neutral-50);">
    <div class="container">
        <div class="row align-items-center mb-5">
            <div class="col">
                <h2 class="mina-heading-2">Quick Actions</h2>
                <p class="text-muted">Get started with these common tasks</p>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <a href="{{ url_for('transcription.live_transcription') }}" class="mina-quick-action">
                    <div class="mina-quick-action-icon">
                        <i class="bi bi-mic"></i>
                    </div>
                    <h5 class="mina-heading-5 mb-2">Start Live Session</h5>
                    <p class="text-muted small mb-0">Begin real-time speech transcription with AI</p>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <a href="{{ url_for('transcription.list_sessions') }}" class="mina-quick-action">
                    <div class="mina-quick-action-icon">
                        <i class="bi bi-folder"></i>
                    </div>
                    <h5 class="mina-heading-5 mb-2">View Sessions</h5>
                    <p class="text-muted small mb-0">Browse and manage your transcription history</p>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <a href="/api/enhanced-ws/info" class="mina-quick-action" target="_blank" rel="noopener">
                    <div class="mina-quick-action-icon">
                        <i class="bi bi-gear"></i>
                    </div>
                    <h5 class="mina-heading-5 mb-2">System Info</h5>
                    <p class="text-muted small mb-0">Check enhanced transcription capabilities</p>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <a href="/api/enhanced-ws/health" class="mina-quick-action" target="_blank" rel="noopener">
                    <div class="mina-quick-action-icon">
                        <i class="bi bi-activity"></i>
                    </div>
                    <h5 class="mina-heading-5 mb-2">Health Check</h5>
                    <p class="text-muted small mb-0">Monitor system health and performance</p>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Recent Activity Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="mina-card">
                    <div class="mina-card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mina-heading-5 mb-1">Recent Activity</h5>
                                <p class="text-muted small mb-0">Latest transcription sessions and system events</p>
                            </div>
                            <a href="{{ url_for('transcription.list_sessions') }}" class="mina-btn mina-btn-ghost mina-btn-sm">
                                View All
                                <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                    <div class="mina-card-body p-0">
                        {% if recent_sessions %}
                        {% for session in recent_sessions %}
                        <div class="mina-activity-item">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="mina-status-dot mina-status-dot-{{ 'success' if session.status == 'completed' else 'warning' }}"></div>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">{{ session.title or 'Transcription Session' }}</h6>
                                            <small class="text-muted">
                                                <i class="bi bi-clock me-1"></i>
                                                {{ session.started_at.strftime('%B %d, %Y at %I:%M %p') if session.started_at else 'Recently' }}
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="mina-badge mina-badge-{{ 'success' if session.status == 'completed' else 'warning' }}">
                                                {{ session.status.title() }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center py-5">
                            <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                            <h6 class="text-muted mt-3">No recent activity</h6>
                            <p class="text-muted small">Start your first transcription session to see activity here</p>
                            <a href="{{ url_for('transcription.live_transcription') }}" class="mina-btn mina-btn-primary">
                                <i class="bi bi-mic"></i>
                                Start First Session
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="mina-card">
                    <div class="mina-card-header">
                        <h5 class="mina-heading-5 mb-1">System Status</h5>
                        <p class="text-muted small mb-0">Real-time system monitoring</p>
                    </div>
                    <div class="mina-card-body">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <span>Enhanced WebSocket</span>
                            <span class="mina-badge mina-badge-success">
                                <i class="mina-status-dot mina-status-dot-success me-1"></i>
                                Online
                            </span>
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <span>AI Transcription</span>
                            <span class="mina-badge mina-badge-success">
                                <i class="mina-status-dot mina-status-dot-success me-1"></i>
                                Ready
                            </span>
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <span>Audio Processing</span>
                            <span class="mina-badge mina-badge-success">
                                <i class="mina-status-dot mina-status-dot-success me-1"></i>
                                Optimal
                            </span>
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <span>Database</span>
                            <span class="mina-badge mina-badge-success">
                                <i class="mina-status-dot mina-status-dot-success me-1"></i>
                                Connected
                            </span>
                        </div>
                        
                        <div class="border-top pt-3">
                            <div class="small text-muted mb-2">Google Recorder-Level Features</div>
                            <div class="d-flex flex-wrap gap-1">
                                <span class="mina-badge mina-badge-info">< 400ms Latency</span>
                                <span class="mina-badge mina-badge-info">Real-time</span>
                                <span class="mina-badge mina-badge-info">AI-Powered</span>
                                <span class="mina-badge mina-badge-info">Mobile Ready</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tips Card -->
                <div class="mina-card mt-4">
                    <div class="mina-card-header">
                        <h5 class="mina-heading-5 mb-1">
                            <i class="bi bi-lightbulb text-warning me-2"></i>
                            Pro Tips
                        </h5>
                    </div>
                    <div class="mina-card-body">
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <small>Use a quiet environment for best accuracy</small>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <small>Position microphone 6-12 inches from mouth</small>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <small>Speak clearly at a moderate pace</small>
                            </li>
                            <li class="mb-0">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <small>Check audio quality indicators in real-time</small>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Enhanced dashboard interactions -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress ring
    setTimeout(() => {
        const progressCircle = document.querySelector('.mina-progress-ring .progress');
        if (progressCircle) {
            progressCircle.classList.add('animate');
        }
    }, 500);
    
    // Add hover effects to stat cards
    const statCards = document.querySelectorAll('.mina-stat-card');
    statCards.forEach((card, index) => {
        setTimeout(() => {
            card.classList.add('mina-revealed');
        }, index * 100);
    });
    
    // Auto-refresh system status every 30 seconds
    setInterval(async () => {
        try {
            const response = await fetch('/api/enhanced-ws/health');
            if (response.ok) {
                const data = await response.json();
                console.log('System health check:', data);
                
                // Update status indicators based on health check
                if (data.healthy) {
                    document.querySelectorAll('.mina-status-dot').forEach(dot => {
                        dot.className = 'mina-status-dot mina-status-dot-success';
                    });
                }
            }
        } catch (error) {
            console.warn('Health check failed:', error);
        }
    }, 30000);
    
    // Show welcome message for new users
    if ({{ '1' if not recent_sessions else '0' }}) {
        setTimeout(() => {
            if (window.showToast) {
                window.showToast(
                    'Welcome to Mina! Start your first transcription session to experience Google Recorder-level performance.',
                    'info',
                    'Welcome!'
                );
            }
        }, 2000);
    }
});
</script>
{% endblock %}